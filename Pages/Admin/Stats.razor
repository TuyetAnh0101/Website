@page "/admin/stats"
@inject IJSRuntime JS
@using System.Net.Http.Json
@using SportsStore.Models.ViewModels
@using Microsoft.JSInterop

<h3>📊 Thống kê doanh thu</h3>

<div class="row mb-3">
    <div class="col-md-3">
        <label for="startDate">Từ ngày:</label>
        <input type="date" class="form-control" @bind="startDate" />
    </div>
    <div class="col-md-3">
        <label for="endDate">Đến ngày:</label>
        <input type="date" class="form-control" @bind="endDate" />
    </div>
    <div class="col-md-3 align-self-end">
        <button class="btn btn-primary" @onclick="LoadRevenueStats">Lọc thống kê</button>
    </div>
</div>

<canvas id="revenueChart" width="800" height="400"></canvas>

@code {
    private DateTime startDate = DateTime.Today.AddDays(-7);
    private DateTime endDate = DateTime.Today;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await LoadRevenueStats();
        }
    }

    private async Task LoadRevenueStats()
    {
        // ✅ Đổi tham số: fromDate / toDate đúng với controller
        string url = $"/admin/stats/revenue?fromDate={startDate:yyyy-MM-dd}&toDate={endDate:yyyy-MM-dd}";
        var stats = await Http.GetFromJsonAsync<List<RevenueStats>>(url);
        await JS.InvokeVoidAsync("drawRevenueChart", stats);
    }

    [Inject] public HttpClient Http { get; set; }
}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="js/chart-utils.js"></script>
